{
  "edges": [
    {
      "from": "tools",
      "to": "bot-prompt",
      "constant": true,
      "out": "tools",
      "in": "tools"
    },
    {
      "from": "order-format",
      "to": "bot-prompt",
      "constant": true,
      "out": "order-format",
      "in": "order-format"
    },
    {
      "from": "passthrough-1",
      "to": "customerMemory",
      "out": "accumulator",
      "in": "accumulator"
    },
    {
      "from": "customerMemory",
      "to": "agentMemory",
      "out": "accumulator",
      "in": "accumulator"
    },
    {
      "from": "agentMemory",
      "to": "toolMemory",
      "out": "accumulator",
      "in": "accumulator"
    },
    {
      "from": "agentMemory",
      "to": "customerMemory",
      "out": "accumulator",
      "in": "accumulator"
    },
    {
      "from": "toolMemory",
      "to": "agentMemory",
      "out": "accumulator",
      "in": "accumulator"
    },
    {
      "from": "customerMemory",
      "to": "bot-prompt",
      "out": "accumulator",
      "in": "memory"
    },
    {
      "from": "toolMemory",
      "to": "bot-prompt",
      "out": "accumulator",
      "in": "memory"
    },
    {
      "from": "slot-4",
      "to": "toolMemory",
      "out": "bot",
      "in": "Tool"
    },
    {
      "from": "slot-4",
      "to": "output-5",
      "out": "bot",
      "in": "bot"
    },
    {
      "from": "slot-4",
      "to": "error",
      "out": "error",
      "in": "error"
    },
    {
      "from": "jsonata-3",
      "to": "slot-4",
      "out": "result",
      "in": "customer"
    },
    {
      "from": "passthrough-2",
      "to": "jsonata-3",
      "out": "checkMenu",
      "in": "json"
    },
    {
      "from": "toolRouter",
      "to": "output-6",
      "out": "customer",
      "in": "bot"
    },
    {
      "from": "input-8",
      "to": "customerMemory",
      "out": "customer",
      "in": "Customer"
    },
    {
      "from": "jsonata-7",
      "to": "input-8",
      "out": "result",
      "in": "message"
    },
    {
      "from": "toolRouter",
      "to": "jsonata-7",
      "out": "customer",
      "in": "json"
    },
    {
      "from": "toolRouter",
      "to": "passthrough-2",
      "out": "checkMenu",
      "in": "checkMenu"
    },
    {
      "from": "toolRouter",
      "to": "finalizeOrder",
      "out": "finalizeOrder",
      "in": "bot"
    },
    {
      "from": "input-9",
      "to": "customerMemory",
      "out": "customer",
      "in": "Customer"
    },
    {
      "from": "generateText-10",
      "to": "toolRouter",
      "out": "completion",
      "in": "completion"
    },
    {
      "from": "generateText-10",
      "to": "agentMemory",
      "out": "completion",
      "in": "Agent"
    },
    {
      "from": "generateText-10",
      "to": "blocked",
      "out": "filters",
      "in": "filters"
    },
    {
      "from": "secrets-11",
      "to": "generateText-10",
      "constant": true,
      "out": "PALM_KEY",
      "in": "PALM_KEY"
    },
    {
      "from": "bot-prompt",
      "to": "generateText-10",
      "out": "prompt",
      "in": "text"
    }
  ],
  "nodes": [
    {
      "id": "bot-prompt",
      "type": "promptTemplate",
      "configuration": {
        "template": "You are the ordering agent and your job is to assist customers with ordering items on the menu.\n\nYou have access to the following tools:\n{{tools}}\n\nIt is your responsibility to manage the state of the currentOrder. Add, remove, and change items as you use tools and interact with the customer.\n\nYour conversation with the customer will follow the pattern of \"Customer\", \"Agent\" and \"Tool\" interleaving, like this:\n\nCustomer: the customer request with which you must assist \nAgent: your response\nTool: response from the tool that was invoked\nAgent: your next action\nCustomer: possible reply for the customer\n... and so on ...\n\nThis pattern may repeat several times until the customer's request is finalized.\n\nYour response must be a valid JSON of the following format:\n{{order-format}}\n\nBegin!\n{{memory}}\nAgent: "
      }
    },
    {
      "id": "tools",
      "type": "passthrough",
      "configuration": {
        "tools": "[\n  {\n    \"name\": \"checkMenu\",\n    \"description\": \"Check to see if the item requested match items on the menu\",\n    \"input\": \"Name of the item that the customer requested\"\n  },\n  {\n    \"name\": \"finalizeOrder\",\n    \"description\": \"Finalize the order and send it for fulfillment\",\n    \"input\": \"none\"\n  },\n  {\n    \"name\": \"customer\",\n    \"description\": \"Interact with the customer to continue assisting with the order\",\n    \"input\": \"the message to send to the customer\"\n  }\n]\n"
      }
    },
    {
      "id": "order-format",
      "type": "passthrough",
      "configuration": {
        "order-format": "{\n  \"thought\": \"starting with a summary of order state (what's been done), a string describing how you decide on the next action, given the previous customer replies.\",\n  \"action\": \"a string with one of the following values: checkMenu, finalizeOrder, customer\",\n  \"actionInput\": \"a string with the input for the action\",\n  \"orderType\": \"string of either \\\"here\\\" (default) or \\\"to go\\\"\",\n  \"currentOrder\": [\n    {\n      \"item\": \"name\",\n      \"extras\": \"array of extras and options for the item\",\n      \"quantity\": \"a number of items\"\n    },\n    {\n      \"item\": \"name\",\n      \"extras\": \"array of extras and options for the item\",\n      \"quantity\": \"a number of items\"\n    }\n  ]\n}\n"
      }
    },
    {
      "id": "customerMemory",
      "type": "append"
    },
    {
      "id": "agentMemory",
      "type": "append"
    },
    {
      "id": "toolMemory",
      "type": "append"
    },
    {
      "id": "passthrough-1",
      "type": "passthrough",
      "configuration": {
        "accumulator": "\n"
      }
    },
    {
      "id": "passthrough-2",
      "type": "passthrough"
    },
    {
      "id": "jsonata-3",
      "type": "jsonata",
      "configuration": {
        "expression": "actionInput"
      }
    },
    {
      "id": "slot-4",
      "type": "slot",
      "configuration": {
        "slot": "checkMenu"
      }
    },
    {
      "id": "output-5",
      "type": "output"
    },
    {
      "id": "error",
      "type": "output"
    },
    {
      "id": "toolRouter",
      "type": "runJavascript",
      "configuration": {
        "name": "route",
        "code": "function route({ completion }) {\n    const data = JSON.parse(completion);\n    return { [data.action]: data };\n}",
        "raw": true
      }
    },
    {
      "id": "output-6",
      "type": "output"
    },
    {
      "id": "jsonata-7",
      "type": "jsonata",
      "configuration": {
        "expression": "actionInput"
      }
    },
    {
      "id": "input-8",
      "type": "input"
    },
    {
      "id": "finalizeOrder",
      "type": "output"
    },
    {
      "id": "input-9",
      "type": "input"
    },
    {
      "id": "generateText-10",
      "type": "generateText",
      "configuration": {
        "stopSequences": [
          "Tool:",
          "Customer:",
          "\n\n"
        ],
        "safetySettings": [
          {
            "category": "HARM_CATEGORY_DEROGATORY",
            "threshold": "BLOCK_MEDIUM_AND_ABOVE"
          }
        ]
      }
    },
    {
      "id": "blocked",
      "type": "output"
    },
    {
      "id": "secrets-11",
      "type": "secrets",
      "configuration": {
        "keys": [
          "PALM_KEY"
        ]
      }
    }
  ],
  "kits": [
    {
      "url": "npm:@google-labs/llm-starter"
    }
  ]
}