<!DOCTYPE html>
<style>
  #log,
  #url,
  input {
    white-space: pre-wrap;
    font-family: Fira Code, monospace;
    font-size: 1.1rem;
  }

  div,
  form {
    padding-bottom: 1rem;
  }
</style>
<div id="url"></div>
<form>
  <input name="text" placeholder="enter text" /><input
    type="submit"
    value="Ask"
  />
</form>
<div id="log"></div>
<script type="module">
  const log = document.querySelector("#log");
  const form = document.querySelector("form");
  let $ticket = undefined;
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const text = form.text.value;
    log.append(`user: ${text}\n`);
    const url = new URL(window.location);
    const response = await fetch(url, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ text, $ticket }),
    });
    const data = await response.json();
    $ticket = data.$ticket;
    log.append(`board: ${data.text}\n`);
  });

  {
    const response = await fetch("/info");
    const data = await response.json();
    const a = document.createElement("a");
    a.href = data.url;
    a.textContent = "Board URL";
    document.querySelector("#url").append(a);
  }
</script>
